<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1811512062866346');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1811512062866346&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-P2WCV5PQ');</script>
    <!-- End Google Tag Manager -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DT5639KD58"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      gtag('config', 'G-DT5639KD58');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guru Sampoorna - Product Catalogue</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Alice&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Alice', serif;
            background-color: #fffaf0; /* Floral White */
        }
        .font-brand {
            font-family: 'Playfair Display', serif;
        }
        .product-card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            border: 1px solid #F3E5F5;
            background: white;
        }
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .btn-primary {
            background-color: #fdba74; /* Light Orange */
            color: #000000; /* Black */
            transition: all 0.4s ease;
            border: 1px solid transparent;
        }
        .btn-primary:hover {
            background-color: #fb923c; /* Darker Orange */
            transform: translateY(-2px);
            box-shadow: 0 4px 15px 0 rgba(251, 146, 60, 0.4); /* Orange Shadow */
        }
        .variant-label input:checked + span {
            border-color: #8D6E63;
            background-color: #EFEBE9;
            color: #3E2723;
            font-weight: 600;
        }
        /* Wishlist Heart Icon Styling */
        .wishlist-btn .heart-icon {
            fill: #d1d5db; /* Gray color for inactive */
            stroke: #4b5563;
            transition: all 0.2s ease-in-out;
        }
        .wishlist-btn.active .heart-icon {
            fill: #ef4444; /* Red color for active */
            stroke: #ef4444;
        }
        /* Sidebar transitions */
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .sidebar.closed {
            transform: translateX(100%);
        }
        /* Add to cart button animation */
        .add-to-cart-btn.added {
            background-color: #4caf50; /* Success Green */
            transform: scale(1.05);
        }
        /* Price pop-up animation */
        @keyframes price-popup-animation {
            0% { transform: translateY(0) scale(0.8); opacity: 0; }
            50% { transform: translateY(-25px) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(0.8); opacity: 0; }
        }
        .price-popup {
            position: absolute;
            top: -15px;
            right: 10px;
            background-color: #22c55e;
            color: white;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: bold;
            animation: price-popup-animation 1.5s ease-in-out forwards;
            pointer-events: none;
        }
        /* To hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        /* Category Button Styles */
        .category-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            background-color: #EFEBE9;
            color: #6D4C41;
            border: 2px solid transparent;
        }
        .category-btn:hover {
            background-color: #D7CCC8;
        }
        .category-btn.active {
            background-color: #fef08a; /* Light Yellow */
            color: #000000; /* Black */
            border-color: #facc15; /* Darker Yellow */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        /* Image Gallery Styles */
        .product-image-container {
            position: relative;
            width: 100%;
            height: 224px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-color: #f9f5f1;
        }
        .product-image-container .gallery-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 10px;
            position: absolute;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .product-image-container .gallery-image.active {
            opacity: 1;
        }
        .gallery-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 0.5rem;
        }
        .gallery-nav button {
            background-color: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .gallery-dots {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }
        .gallery-dots .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }
        .gallery-dots .dot.active {
            background-color: rgba(0, 0, 0, 0.7);
        }

        /* Toast Notification */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 600;
            z-index: 100;
            opacity: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(120%);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .toast-notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        .toast-notification.error {
            background-color: #ef4444; /* red-500 */
        }
        .toast-notification.success {
            background-color: #22c55e; /* green-500 */
        }
        /* Loading Spinner */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #8D6E63;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 4rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Modal Styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        /* New Search Styles */
        #search-wrapper #search-input {
            width: 0;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            opacity: 0;
            pointer-events: none;
            transition: width 0.3s ease-in-out, opacity 0.2s ease-in-out;
        }
        #search-wrapper.active #search-input {
            width: 16rem; /* w-64 */
            opacity: 1;
            pointer-events: auto;
            border-color: #FBC02D;
            padding-left: 2.5rem;
        }

        /* App Footer Styles */
        body {
            padding-bottom: 80px; /* Add space for the fixed footer */
        }
        .app-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #ffffff;
            border-top: 1px solid #e5e7eb;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            z-index: 45; /* Below sidebars but above content */
        }
        .footer-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 0;
            color: #4b5563; /* text-gray-600 */
            font-size: 0.75rem; /* text-xs */
            font-weight: 500;
            transition: color 0.2s ease-in-out, background-color 0.2s ease-in-out;
            text-decoration: none;
        }
        .footer-btn:hover {
            color: #ca8a04; /* amber-600 */
            background-color: #f9fafb; /* gray-50 */
        }
        body[lang="hi"] .footer-btn {
            font-weight: 700;
        }

        /* Floating Cart Pill Styles - REVISED */
        #floating-cart-pill {
            position: fixed;
            bottom: 70px; /* Above the footer */
            left: 50%;
            /* transform handles the entrance slide */
            transform: translateX(-50%) translateY(100px); 
            width: auto; /* Allow content to dictate width (smaller) */
            min-width: 250px; /* Minimum width for aesthetics */
            max-width: 90%; 
            background-color: #15803d; /* Green-700 */
            color: white;
            border-radius: 9999px;
            padding: 0.5rem 1.25rem; /* Standard padding */
            display: flex;
            align-items: center;
            justify-content: space-between; 
            gap: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            z-index: 40;
            cursor: pointer;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease;
            opacity: 0;
            pointer-events: none;
        }

        /* Animation for floating effect using margin to avoid transform conflict */
        @keyframes float-vertical {
            0%, 100% { bottom: 70px; }
            50% { bottom: 78px; }
        }

        #floating-cart-pill.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
            pointer-events: auto;
            /* Add floating animation */
            animation: float-vertical 3s ease-in-out infinite; 
        }

        .cart-pill-thumb {
            width: 36px; 
            height: 36px;
            border-radius: 50%; 
            object-fit: cover;
            border: 2px solid white;
        }
        
        /* UPDATED SIDEBAR CATEGORY CARD STYLES */
        .sidebar-category-btn {
             /* Card Styling handled by Tailwind classes in JS, here we just handle interactions */
             transition: all 0.2s ease-in-out;
        }
        .sidebar-category-btn:hover {
            transform: translateY(-2px);
            /* hover colors handled in tailwind classes */
        }
        .sidebar-category-btn.active {
            /* Active state: strong border/ring for cards */
            border-color: #d97706 !important; /* amber-600 */
            background-color: #fffbeb !important; /* amber-50 */
            box-shadow: 0 0 0 2px rgba(217, 119, 6, 0.2);
        }
        
        /* NEW: Specific Active Styling for Top Strip Circles */
        /* This ensures the active circle turns Amber, while others stay Red */
        .sidebar-category-btn.active .circle-icon-container {
            border-color: #d97706 !important; /* Amber border when active */
            color: #d97706 !important; /* Amber icon when active */
            background-color: #fff7ed; /* Light amber bg when active */
        }

        /* Pagination Button Styles */
        .pagination-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid #d1d5db;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            background-color: white;
            color: #374151;
            font-weight: 600;
            margin: 0 0.25rem;
        }
        .pagination-btn:hover {
            background-color: #fff7ed;
            border-color: #fdba74;
            color: #ca8a04;
        }
        .pagination-btn.active {
            background-color: #fdba74;
            color: #000000;
            border-color: #fb923c;
            transform: scale(1.1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Cart Blink Animation */
        @keyframes blink-attention {
            0%, 100% { transform: scale(1); color: #4b5563; } /* Default gray */
            5% { transform: scale(1.2); color: #d97706; } /* Amber pop */
            10% { transform: scale(1); color: #4b5563; }
            15% { transform: scale(1.2); color: #d97706; } /* Second pop */
            20% { transform: scale(1); color: #4b5563; }
            /* 20% to 100% is idle time (4 seconds) */
        }
        
        /* Apply blinking only to the icon SVG when this class is present */
        .cart-blink .relative svg {
            animation: blink-attention 5s infinite ease-in-out;
            stroke-width: 2.5px; /* Make it slightly bolder when active */
        }

        /* Custom Scrollbar Styling - High Visibility */
        /* Works on Chrome, Edge, and Safari */
        ::-webkit-scrollbar {
            width: 8px; /* Width for vertical scrollbar */
            height: 8px; /* Height for horizontal scrollbar */
        }

        ::-webkit-scrollbar-track {
            background: rgba(251, 191, 36, 0.1); /* Very light amber track */
        }

        ::-webkit-scrollbar-thumb {
            background-color: #d97706; /* Amber-600 thumb */
            border-radius: 4px;
            border: 1px solid rgba(251, 191, 36, 0.1);
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #b45309; /* Amber-700 on hover */
        }

        /* Firefox Fallback */
        html {
            scrollbar-width: thin;
            scrollbar-color: #d97706 rgba(251, 191, 36, 0.1);
        }

        /* Utility to hide scrollbar for app-like horizontal scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        /* Product Modal Transition */
        #product-modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #product-modal.open {
            opacity: 1;
            visibility: visible;
        }
        #product-modal.closed {
            opacity: 0;
            visibility: hidden;
        }
        #product-modal .modal-panel {
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            transform: translateY(100%); /* Start from bottom */
        }
        #product-modal.open .modal-panel {
            transform: translateY(0);
        }
        @media (min-width: 640px) {
            #product-modal .modal-panel {
                transform: scale(0.95);
                opacity: 0;
            }
            #product-modal.open .modal-panel {
                transform: scale(1);
                opacity: 1;
            }
        }
        /* Increased Z-Index for Know More Modal to appear above Product Modal */
        #know-more-modal {
            z-index: 60; 
        }

        /* Marquee Animation for Announcement Bar */
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .animate-marquee {
            display: inline-block;
            white-space: nowrap;
            animation: marquee 20s linear infinite;
            /* Ensure it doesn't overlap header elements */
            will-change: transform;
        }
    </style>
</head>
<body lang="en"> <!-- Language attribute will be set by JS -->
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P2WCV5PQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="container mx-auto px-4 sm:px-6 md:px-8">
        <!-- Header Section with Search, Wishlist, and Cart -->
        <!-- CHANGED: Moved Category Strip INSIDE header for sticky behavior -->
        <header class="sticky top-0 z-20 bg-[#fffaf0] shadow-sm pb-1 transition-all duration-300">
            <!-- CHANGED: Added border-b border-amber-200 to create the separator line -->
            <div class="flex justify-between items-center py-2 border-b border-amber-200 mb-2">
                <!-- Left: Search Bar -->
                <div class="flex-1">
                    <div id="search-component" class="relative w-max">
                        <input id="search-input" type="text" placeholder="Search..." class="h-11 pl-12 pr-4 rounded-full text-sm focus:outline-none transition-all duration-300 w-11 focus:w-64 border-2 border-transparent focus:border-amber-400">
                        <!-- UPDATED SEARCH ICON: Added id, fixed width/centering for better click target -->
                        <span id="search-icon-btn" class="absolute left-0 top-0 h-11 w-11 flex items-center justify-center text-black cursor-pointer z-10" onclick="gtag('event', 'search_icon_click', { 'event_category': 'engagement', 'event_label': 'Search Icon' });">
                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </span>
                        <div id="search-results" class="absolute top-full left-0 mt-1 w-64 bg-white rounded-md shadow-lg max-h-60 overflow-y-auto z-30 hidden"></div>
                    </div>
                </div>

                <!-- Center: Logo (Added ID and Transition Classes) -->
                <div id="header-logo" class="flex-shrink-0 transition-all duration-300 ease-in-out transform origin-center overflow-hidden">
                    <img src="https://i.ibb.co/n8r4SFNH/1002397847-removebg-preview-1.png" alt="Guru Sampoorna Logo" class="w-20 h-auto">
                </div>

                <!-- Right: Hamburger Menu & Language Switch -->
                <div class="flex-1 flex justify-end items-center space-x-3">
                    <!-- Language Switch Button (Moved to be the primary action here) -->
                    <button id="lang-switch-btn" class="text-sm font-bold text-amber-800 border border-amber-800 px-3 py-1 rounded-full hover:bg-amber-100 transition-colors" data-key="langSwitch">
                        ‡§π‡§ø‡§Ç‡§¶‡•Ä
                    </button>

                    <!-- Hamburger Menu Icon REMOVED -->
                </div>
            </div>

            <!-- NEW: Scrollable Category Strip with Fade Hint (Inside Sticky Header) -->
            <!-- UPDATED: Changed bg-red-50 to bg-white -->
            <div class="relative group mt-1 bg-white">
                <!-- The Strip -->
                <!-- Reduced padding-top (py-1 -> py-0) since we added margin to the separator above -->
                <div id="top-category-strip" class="flex overflow-x-auto gap-3 px-1 py-1 no-scrollbar snap-x scroll-smooth">
                     <!-- Category buttons will be dynamically inserted here -->
                </div>
                <!-- Right Fade Overlay (Visual Hint for Scrolling) -->
                <!-- UPDATED: Changed gradient to from-white to match background -->
                <div class="absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-white to-transparent pointer-events-none flex items-center justify-end">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-red-600 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                    </svg>
                </div>
            </div>

            <!-- Announcement Bar (NEW: Slimmer & Moving) -->
            <!-- UPDATED: Swapped to Green theme -->
            <div class="bg-green-50 py-0.5 overflow-hidden border-t border-green-100">
                <div class="animate-marquee">
                    <span class="text-green-800 text-xs font-bold inline-flex items-center gap-2">
                        Dear customers you can bring your own container for refill of oil. <span class="text-sm">üòä</span>
                    </span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="pt-6"> <!-- Restored padding top -->
            
            <!-- REMOVED: Home View Container -->

            <!-- Categories Container -->
            <div id="product-sections-container">
                <!-- Product sections and cards will be dynamically inserted here -->
                 <div class="loader"></div>
            </div>

            <!-- Category Pagination (Numbered Circles) -->
            <!-- REMOVED 'hidden' class so pagination shows by default -->
            <div id="category-pagination-container" class="flex justify-center items-center flex-wrap mt-12 mb-8 gap-2">
                <!-- Numbered buttons will be dynamically inserted here -->
            </div>

        </main>

        <footer class="text-center mt-16 py-6 border-t border-amber-200">
            <p class="text-gray-600" data-key="footerCopy">&copy; 2024 Guru Sampoorna. All Rights Reserved.</p>
        </footer>
    </div>

    <!-- Floating Cart Pill (Revised for size and center) -->
    <div id="floating-cart-pill" class="hidden">
        <!-- Left: Image & Text Column -->
        <div class="flex items-center gap-3">
            <img id="floating-cart-img" src="https://placehold.co/100x100" alt="Item" class="cart-pill-thumb">
            <div class="flex flex-col text-left">
                <!-- Item Count and Price (JS populates this) -->
                <span id="floating-cart-count" class="font-bold text-sm text-white leading-tight">0 items</span>
                <!-- View Cart Text (Small, below) -->
                <span class="text-xs text-green-200 font-medium">View Cart</span>
            </div>
        </div>
        
        <!-- Right: Arrow Icon -->
        <div class="bg-green-800 rounded-full p-1">
             <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
        </div>
    </div>

    <!-- Support Modal (NEW) -->
    <div id="support-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center transform scale-95 relative">
            <h3 class="text-2xl font-brand font-bold text-gray-800 mb-6" data-key="contactSupport">Contact Support</h3>
            
            <div class="flex flex-col gap-4">
                <a href="tel:6262120120" class="btn-primary w-full py-3 rounded-xl font-semibold flex items-center justify-center gap-3 shadow-sm hover:shadow-md transition-all" onclick="gtag('event', 'contact', {'method': 'phone'}); fbq('track', 'Contact', {content_name: 'phone'});">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                    </svg>
                    <span data-key="callUs">Call Us</span>
                </a>
                
                <a href="https://wa.me/916262120120" target="_blank" class="w-full py-3 rounded-xl font-semibold flex items-center justify-center gap-3 bg-[#25D366] text-white hover:bg-[#128C7E] shadow-sm hover:shadow-md transition-all" onclick="gtag('event', 'contact', {'method': 'whatsapp'}); fbq('track', 'Contact', {content_name: 'whatsapp'});">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                    </svg>
                    <span data-key="whatsappUs">WhatsApp Us</span>
                </a>
            </div>

            <button id="close-support-modal-btn" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <!-- App-like Footer Navigation (Revised Order) -->
    <footer class="app-footer flex justify-around items-start">
        <!-- 1. About Us Icon -->
        <a href="https://gurusampoorna.com/" target="_blank" rel="noopener noreferrer" class="footer-btn" onclick="gtag('event', 'about_us_click', { 'event_category': 'engagement', 'event_label': 'Footer About Us Icon' });">
             <!-- Changed SVG to a User/Human Icon -->
             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
             </svg>
             <span class="mt-1" data-key="aboutUs">About Us</span>
        </a>

        <!-- 2. Categories Icon -->
        <button id="open-category-footer-btn" class="footer-btn" onclick="gtag('event', 'category_footer_click', { 'event_category': 'engagement', 'event_label': 'Footer Category Icon' });">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <circle cx="7" cy="7" r="2.5" />
                <circle cx="17" cy="7" r="2.5" />
                <circle cx="7" cy="17" r="2.5" />
                <circle cx="17" cy="17" r="2.5" />
            </svg>
            <span class="mt-1" data-key="categoriesTitle">Categories</span>
        </button>

        <!-- 3. Wishlist Icon -->
        <button id="open-wishlist-btn" class="footer-btn relative" onclick="gtag('event', 'wishlist_click', { 'event_category': 'engagement', 'event_label': 'Footer Wishlist Icon' });">
            <div class="relative">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                 <span id="wishlist-count-badge" class="absolute -top-1 -right-2 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">0</span>
            </div>
            <span class="mt-1" data-key="wishlist">Wishlist</span>
        </button>

        <!-- 4. Support Icon (NEW) -->
        <button id="open-support-btn" class="footer-btn" onclick="gtag('event', 'support_click', { 'event_category': 'engagement', 'event_label': 'Footer Support Icon' });">
            <!-- Person with Headset Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <!-- Person Head -->
                <path stroke-linecap="round" stroke-linejoin="round" d="M16 8a4 4 0 1 1-8 0 4 4 0 0 1 8 0" />
                <!-- Person Body -->
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 14a7 7 0 0 0-7 7h14a7 7 0 0 0-7-7" />
                <!-- Headset Band -->
                <path stroke-linecap="round" stroke-linejoin="round" d="M20 11v-1a8 8 0 0 0-16 0v1" />
                <!-- Mic -->
                <path stroke-linecap="round" stroke-linejoin="round" d="M20 11v3a1 1 0 0 1-1 1h-2" />
            </svg>
            <span class="mt-1" data-key="support">Support</span>
        </button>
    </footer>

    <!-- Sidebars -->
    
    <!-- Category Menu Sidebar (NEW) -->
    <div id="category-sidebar" class="sidebar closed fixed top-0 right-0 h-full w-full md:w-80 bg-white shadow-lg z-50 flex flex-col">
        <div class="flex justify-between items-center p-4 border-b">
            <h2 class="text-xl font-bold font-brand text-amber-800" data-key="categoriesTitle">Categories</h2>
            <button id="close-category-sidebar-btn" class="text-2xl text-gray-600 hover:text-gray-900">&times;</button>
        </div>
        <!-- CHANGED: Grid layout for cards -->
        <div id="category-list-container" class="flex-grow p-4 overflow-y-auto grid grid-cols-2 gap-4 content-start bg-gray-50">
            <!-- Category cards will be dynamically inserted here -->
        </div>
    </div>

    <div id="cart-sidebar" class="sidebar closed fixed top-0 right-0 h-full w-full md:w-96 bg-white shadow-lg z-50 flex flex-col">
        <div class="flex justify-between items-center p-4 border-b">
            <div class="flex items-center gap-3">
                <h2 class="text-xl font-bold" data-key="cartTitle">Your Cart</h2>
                <button id="how-to-order-btn" class="text-xs bg-gray-100 text-gray-700 font-semibold px-2 py-1 rounded-full hover:bg-gray-200 transition-colors" data-key="howToOrder">How to Order?</button>
            </div>
            <button id="close-cart-btn" class="text-2xl">&times;</button>
        </div>
        <div id="cart-items-container" class="flex-grow p-4 overflow-y-auto"></div>
        <div class="p-4 border-t bg-gray-50">
            <div class="flex justify-between font-bold text-lg mb-4">
                <span data-key="total">Total:</span>
                <span id="cart-total">‚Çπ0</span>
            </div>
            <button id="checkout-btn" class="w-full btn-primary py-3 rounded-lg font-semibold" data-key="checkout" onclick="gtag('event', 'checkout_click', { event_category: 'engagement', event_label: 'Checkout Button' });">Checkout</button>
        </div>
    </div>
    <div id="wishlist-sidebar" class="sidebar closed fixed top-0 right-0 h-full w-full md:w-96 bg-white shadow-lg z-50 flex flex-col">
        <div class="flex justify-between items-center p-4 border-b">
            <h2 class="text-xl font-bold" data-key="wishlistTitle">Your Wishlist</h2>
            <button id="close-wishlist-btn" class="text-2xl">&times;</button>
        </div>
        <div id="wishlist-items-container" class="flex-grow p-4 overflow-y-auto"></div>
    </div>
    <div id="sidebar-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>

    <!-- "Know More" Modal -->
    <div id="know-more-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-md text-center transform scale-95">
            <h3 id="modal-title" class="text-2xl font-brand font-bold text-gray-800 mb-4"></h3>
            <p id="modal-description" class="text-gray-600 mb-6"></p>
            <button id="close-modal-btn" class="btn-primary px-6 py-2 rounded-lg font-semibold" data-key="close">Close</button>
        </div>
    </div>

    <!-- "How to Order" Modal -->
    <div id="how-to-order-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-md transform scale-95">
            <h3 class="text-2xl font-brand font-bold text-gray-800 mb-4 text-center" data-key="howToOrderTitle">How to Place an Order</h3>
            <ol class="list-decimal list-inside text-gray-600 space-y-3 mb-6 text-left">
                <li data-key="howToOrderStep1">Browse our products and add your desired items to the cart.</li>
                <li data-key="howToOrderStep2">Click on the cart icon in the top-right corner to review your order.</li>
                <li data-key="howToOrderStep3">Press the "Checkout" button at the bottom of the cart.</li>
                <li data-key="howToOrderStep4">You will be redirected to WhatsApp with a pre-filled message containing your order details.</li>
                <li data-key="howToOrderStep5">Simply send the message to confirm and place your order!</li>
            </ol>
            <div class="text-center">
                <button id="close-how-to-order-modal-btn" class="btn-primary px-6 py-2 rounded-lg font-semibold" data-key="gotIt">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Product Details Modal (NEW) -->
    <div id="product-modal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center closed">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black bg-opacity-60 transition-opacity" id="product-modal-backdrop"></div>
        
        <!-- Modal Panel (Bottom Sheet on Mobile, Center Card on Desktop) -->
        <div class="modal-panel bg-white w-full sm:w-full sm:max-w-lg sm:rounded-2xl rounded-t-2xl shadow-2xl relative max-h-[90vh] overflow-y-auto flex flex-col">
            <!-- Close Button -->
            <button id="close-product-modal-btn" class="absolute top-4 right-4 z-10 bg-white/80 rounded-full p-2 text-gray-500 hover:text-black shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            
            <!-- Dynamic Content Container -->
            <div id="product-modal-content" class="flex-grow">
                <!-- Full product card details will be injected here -->
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-md transform scale-95 relative">
            <!-- Step 1: New or Returning Customer -->
            <div id="checkout-step-1">
                <h3 class="text-2xl font-brand font-bold text-gray-800 mb-4 text-center" data-key="confirmOrder">Confirm Your Order</h3>
                <p class="text-gray-600 mb-6 text-center" data-key="areYouNew">Are you a new customer?</p>
                <div class="flex flex-col gap-3"> <!-- Changed to flex-col for better readability of longer text -->
                    <button id="new-customer-btn" class="btn-primary w-full py-3 rounded-lg font-semibold" data-key="yesNew">Yes, I'm new (Address needed)</button>
                    <button id="returning-customer-btn" class="bg-gray-200 text-gray-800 w-full py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors" data-key="noReturning">No, I'm old (No address needed)</button>
                </div>
            </div>
            <!-- Step 2: Address for New Customer -->
            <div id="checkout-step-2" class="hidden">
                <h3 class="text-2xl font-brand font-bold text-gray-800 mb-4 text-center" data-key="shippingAddress">Shipping Address</h3>
                <p class="text-gray-600 mb-4 text-center text-sm" data-key="addressPrompt">Please enter your full delivery address.</p>
                <textarea id="shipping-address-input" rows="4" class="w-full border-gray-300 rounded-md p-2 focus:ring-amber-500 focus:border-amber-500" placeholder="Full Name&#10;House No., Street Name&#10;City, State, Pincode&#10;Landmark (optional)"></textarea>
                <p id="address-error" class="text-red-500 text-xs mt-1 hidden" data-key="addressError">Address cannot be empty.</p>
                <!-- RENAMED ID from complete-checkout-btn to proceed-to-payment-btn for clarity, logic handles this -->
                <button id="proceed-to-payment-btn" class="w-full btn-primary py-3 rounded-lg font-semibold mt-4" data-key="proceedToPayment">Proceed to Payment</button>
            </div>
            
            <!-- Step 3: Payment Method Selection (NEW) -->
            <div id="checkout-step-3" class="hidden">
                <h3 class="text-2xl font-brand font-bold text-gray-800 mb-6 text-center" data-key="selectPayment">Select Payment Method</h3>
                <div class="flex flex-col gap-3">
                    <button class="btn-primary w-full py-3 rounded-lg font-semibold payment-btn shadow-sm hover:shadow-md transition-all" data-mode="Cash on Delivery (COD)" data-key="codBtn">Cash on Delivery (COD)</button>
                    <button class="bg-gray-200 text-gray-800 w-full py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors payment-btn shadow-sm" data-mode="Prepaid" data-key="prepaidBtn">Prepaid (UPI/Netbanking)</button>
                </div>
            </div>

            <button id="close-checkout-modal-btn" class="absolute top-2 right-4 text-2xl text-gray-500 hover:text-gray-800">&times;</button>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const googleSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTOBYoHgJGxEOiVx9GvYcXTvzsRT-1kK-P3254UKV-N3BIHWAVT4-6kdVtCi4QJeo4wwsInNY-6Wp3D/pub?output=csv';
        let cart = [], wishlist = [], allProducts = [], allCategories = {};
        const CART_KEY = 'guruSampoornaCart', WISHLIST_KEY = 'guruSampoornaWishlist', LANG_KEY = 'guruSampoornaLang';
        
        // --- LANGUAGE STATE & TRANSLATIONS ---
        let currentLang = localStorage.getItem(LANG_KEY) || 'en';
        
        const uiStrings = {
            en: {
                langSwitch: "‡§π‡§ø‡§Ç‡§¶‡•Ä",
                searchPlaceholder: "Search...",
                noResults: "No results found",
                wishlist: "Wishlist",
                cart: "Cart",
                home: "Home",
                aboutUs: "About Us",
                cartTitle: "Your Cart",
                categoriesTitle: "Categories",
                howToOrder: "How to Order?",
                total: "Total:",
                checkout: "Checkout",
                wishlistTitle: "Your Wishlist",
                emptyCart: "Your cart is empty.",
                emptyWishlist: "Your wishlist is empty.",
                moveToCart: "Move to Cart",
                knowMore: "Know More",
                selectSize: "Select Size:",
                addToCart: "Add to Cart",
                added: "Added!",
                close: "Close",
                howToOrderTitle: "How to Place an Order",
                howToOrderStep1: "Browse our products and add your desired items to the cart.",
                howToOrderStep2: "Click on the cart icon in the top-right corner to review your order.",
                howToOrderStep3: "Press the \"Checkout\" button at the bottom of the cart.",
                howToOrderStep4: "You will be redirected to WhatsApp with a pre-filled message containing your order details.",
                howToOrderStep5: "Simply send the message to confirm and place your order!",
                gotIt: "Got it!",
                confirmOrder: "Confirm Your Order",
                areYouNew: "Are you a new customer?",
                yesNew: "Yes, I'm new (Address needed)",
                noReturning: "No, I'm old (No address needed)",
                shippingAddress: "Shipping Address",
                addressPrompt: "Please enter your full delivery address.",
                addressPlaceholder: "Full Name\nHouse No., Street Name\nCity, State, Pincode\nLandmark (optional)",
                addressError: "Address cannot be empty.",
                completeCheckout: "Complete Checkout",
                proceedToPayment: "Proceed to Payment",
                selectPayment: "Select Payment Method",
                codBtn: "Cash on Delivery (COD)",
                prepaidBtn: "Prepaid (UPI/Netbanking)",
                footerCopy: "¬© 2024 Guru Sampoorna. All Rights Reserved.",
                support: "Support",
                contactSupport: "Contact Support",
                callUs: "Call Us",
                whatsappUs: "WhatsApp Us"
            },
            hi: {
                langSwitch: "English",
                searchPlaceholder: "‡§ñ‡•ã‡§ú‡•á‡§Ç...",
                noResults: "‡§ï‡•ã‡§à ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ",
                wishlist: "‡§µ‡§ø‡§∂‡§≤‡§ø‡§∏‡•ç‡§ü",
                cart: "‡§ï‡§æ‡§∞‡•ç‡§ü",
                home: "‡§π‡•ã‡§Æ",
                aboutUs: "‡§π‡§Æ‡§æ‡§∞‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç",
                cartTitle: "‡§Ü‡§™‡§ï‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§ü",
                categoriesTitle: "‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡§æ‡§Å",
                howToOrder: "‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç?",
                total: "‡§ï‡•Å‡§≤:",
                checkout: "‡§ö‡•á‡§ï‡§Ü‡§â‡§ü",
                wishlistTitle: "‡§Ü‡§™‡§ï‡•Ä ‡§µ‡§ø‡§∂‡§≤‡§ø‡§∏‡•ç‡§ü",
                emptyCart: "‡§Ü‡§™‡§ï‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à‡•§",
                emptyWishlist: "‡§Ü‡§™‡§ï‡•Ä ‡§µ‡§ø‡§∂‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à‡•§",
                moveToCart: "‡§ï‡§æ‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤‡•á‡§Ç",
                knowMore: "‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡•á‡§Ç",
                selectSize: "‡§Ü‡§ï‡§æ‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç:",
                addToCart: "‡§ï‡§æ‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
                added: "‡§ú‡•ã‡§°‡§º ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!",
                close: "‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
                howToOrderTitle: "‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç",
                howToOrderStep1: "‡§π‡§Æ‡§æ‡§∞‡•á ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§™‡§®‡•Ä ‡§á‡§ö‡•ç‡§õ‡§ø‡§§ ‡§µ‡§∏‡•ç‡§§‡•Å‡§ì‡§Ç ‡§ï‡•ã ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§",
                howToOrderStep2: "‡§Ö‡§™‡§®‡•á ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡•Ä ‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ä‡§™‡§∞‡•Ä-‡§¶‡§æ‡§è‡§Å ‡§ï‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§Ü‡§á‡§ï‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",
                howToOrderStep3: "‡§ï‡§æ‡§∞‡•ç‡§ü ‡§ï‡•á ‡§®‡•Ä‡§ö‡•á \"‡§ö‡•á‡§ï‡§Ü‡§â‡§ü\" ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Å‡•§",
                howToOrderStep4: "‡§Ü‡§™‡§ï‡•ã ‡§Ö‡§™‡§®‡•á ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§µ‡§æ‡§≤‡•á ‡§è‡§ï ‡§™‡•Ç‡§∞‡•ç‡§µ-‡§≠‡§∞‡•á ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ ‡§™‡§∞ ‡§™‡•Å‡§®‡§É ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§",
                howToOrderStep5: "‡§Ö‡§™‡§®‡§æ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§™‡§ï‡•ç‡§ï‡§æ ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§¶‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§∏ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≠‡•á‡§ú‡•á‡§Ç!",
                gotIt: "‡§∏‡§Æ‡§ù ‡§ó‡§Ø‡§æ!",
                confirmOrder: "‡§Ö‡§™‡§®‡•á ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç",
                areYouNew: "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§®‡§è ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§π‡•à‡§Ç?",
                yesNew: "‡§π‡§æ‡§Å, ‡§Æ‡•à‡§Ç ‡§®‡§Ø‡§æ ‡§π‡•Ç‡§Å (‡§™‡§§‡§æ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à)",
                noReturning: "‡§®‡§π‡•Ä‡§Ç, ‡§Æ‡•à‡§Ç ‡§™‡•Å‡§∞‡§æ‡§®‡§æ ‡§π‡•Ç‡§Å (‡§™‡§§‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç)",
                shippingAddress: "‡§∂‡§ø‡§™‡§ø‡§Ç‡§ó ‡§™‡§§‡§æ",
                addressPrompt: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§™‡§§‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§",
                addressPlaceholder: "‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ\n‡§Æ‡§ï‡§æ‡§® ‡§®‡§Ç‡§¨‡§∞, ‡§ó‡§≤‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ\n‡§∂‡§π‡§∞, ‡§∞‡§æ‡§ú‡•ç‡§Ø, ‡§™‡§ø‡§®‡§ï‡•ã‡§°\n‡§≤‡•à‡§Ç‡§°‡§Æ‡§æ‡§∞‡•ç‡§ï (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)",
                addressError: "‡§™‡§§‡§æ ‡§ñ‡§æ‡§≤‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ‡•§",
                completeCheckout: "‡§ö‡•á‡§ï‡§Ü‡§â‡§ü ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞‡•á‡§Ç",
                proceedToPayment: "‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç",
                selectPayment: "‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§æ ‡§§‡§∞‡•Ä‡§ï‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç",
                codBtn: "‡§ï‡•à‡§∂ ‡§ë‡§® ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä (COD)",
                prepaidBtn: "‡§™‡•ç‡§∞‡•Ä‡§™‡•á‡§° (UPI/‡§®‡•á‡§ü‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó)",
                footerCopy: "¬© 2024 ‡§ó‡•Å‡§∞‡•Å ‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£‡•§ ‡§∏‡§∞‡•ç‡§µ‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§‡•§",
                support: "‡§∏‡§π‡§Ø‡•ã‡§ó",
                contactSupport: "‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç",
                callUs: "‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç",
                whatsappUs: "‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ ‡§ï‡§∞‡•á‡§Ç"
            }
        };
        // --- END LANGUAGE ---

        const cartSidebar = document.getElementById('cart-sidebar'),
              wishlistSidebar = document.getElementById('wishlist-sidebar'),
              categorySidebar = document.getElementById('category-sidebar'),
              sidebarOverlay = document.getElementById('sidebar-overlay'),
              searchInput = document.getElementById('search-input'),
              searchResultsContainer = document.getElementById('search-results'),
              checkoutBtn = document.getElementById('checkout-btn'),
              openCartBtn = document.getElementById('open-cart-btn'), // Note: this might be null if we removed the top header cart, but we kept top header cart
              closeCartBtn = document.getElementById('close-cart-btn'),
              openWishlistBtn = document.getElementById('open-wishlist-btn'),
              closeWishlistBtn = document.getElementById('close-wishlist-btn'),
              openCategoryMenuBtn = document.getElementById('open-category-menu-btn'), // Now null
              openCategoryFooterBtn = document.getElementById('open-category-footer-btn'), 
              closeCategorySidebarBtn = document.getElementById('close-category-sidebar-btn'),
              cartItemsContainer = document.getElementById('cart-items-container'),
              wishlistItemsContainer = document.getElementById('wishlist-items-container'),
              categoryListContainer = document.getElementById('category-list-container'),
              categoryPaginationContainer = document.getElementById('category-pagination-container'), 
              cartTotalEl = document.getElementById('cart-total'),
              cartCountBadge = document.getElementById('cart-count-badge'), // Top header badge
              wishlistCountBadge = document.getElementById('wishlist-count-badge'),
              productSectionsContainer = document.getElementById('product-sections-container'),
              // Removed homeView variable
              topCategoryStrip = document.getElementById('top-category-strip'), // UPDATED Variable Name
              knowMoreModal = document.getElementById('know-more-modal'),
              modalTitle = document.getElementById('modal-title'),
              modalDescription = document.getElementById('modal-description'),
              closeModalBtn = document.getElementById('close-modal-btn'),
              howToOrderBtn = document.getElementById('how-to-order-btn'),
              howToOrderModal = document.getElementById('how-to-order-modal'),
              closeHowToOrderModalBtn = document.getElementById('close-how-to-order-modal-btn'),
              productModal = document.getElementById('product-modal'), // NEW
              productModalContent = document.getElementById('product-modal-content'), // NEW
              closeProductModalBtn = document.getElementById('close-product-modal-btn'), // NEW
              productModalBackdrop = document.getElementById('product-modal-backdrop'), // NEW
              checkoutModal = document.getElementById('checkout-modal'),
              newCustomerBtn = document.getElementById('new-customer-btn'),
              returningCustomerBtn = document.getElementById('returning-customer-btn'),
              proceedToPaymentBtn = document.getElementById('proceed-to-payment-btn'), // Renamed from completeCheckoutBtn
              closeCheckoutModalBtn = document.getElementById('close-checkout-modal-btn'),
              shippingAddressInput = document.getElementById('shipping-address-input'),
              addressError = document.getElementById('address-error'),
              checkoutStep1 = document.getElementById('checkout-step-1'),
              checkoutStep2 = document.getElementById('checkout-step-2'),
              checkoutStep3 = document.getElementById('checkout-step-3'), // NEW
              langSwitchBtn = document.getElementById('lang-switch-btn'),
              floatingCartPill = document.getElementById('floating-cart-pill'), 
              floatingCartCount = document.getElementById('floating-cart-count'), 
              floatingCartImg = document.getElementById('floating-cart-img'),
              searchIconBtn = document.getElementById('search-icon-btn'), // New
              headerLogo = document.getElementById('header-logo'), // New
              openSupportBtn = document.getElementById('open-support-btn'), // NEW
              supportModal = document.getElementById('support-modal'), // NEW
              closeSupportModalBtn = document.getElementById('close-support-modal-btn'); // NEW
        
        async function init() {
            loadStateFromLocalStorage();
            await fetchAndRenderProducts();
            
            setupEventListeners();
            updateAllCartUI();
            updateAllWishlistUI();
            renderAll(); // Render initial text based on stored language
        }

        // --- MASTER RENDER FUNCTION ---
        function renderAll() {
            document.body.setAttribute('lang', currentLang); // Set lang attribute for CSS styling
            
            // 1. Render Static UI Strings
            const strings = uiStrings[currentLang];
            searchInput.placeholder = strings.searchPlaceholder;
            shippingAddressInput.placeholder = strings.addressPlaceholder;
            
            // Update the language button text
            if(langSwitchBtn) langSwitchBtn.textContent = strings.langSwitch;

            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (strings[key]) el.textContent = strings[key];
            });

            // 2. Re-render Products & Categories if data exists
            if (Object.keys(allCategories).length > 0) {
                renderCategories(allCategories); // Re-render categories with translated names
                renderPagination(allCategories); // NEW: Render bottom numbered pagination
                renderProducts(allCategories);   // Re-render products (descriptions etc.)
                // Removed renderHome call
            }
            
            // 3. Re-render Cart & Wishlist to update labels
            renderCart();
            renderWishlist();
        }

        // Removed renderHome function and showHomePage function

        function parseCSV(text) {
            const rows = text.split(/\r?\n/);
            const headers = (rows.shift() || '').split(',');
            const products = rows.map(row => {
                if (!row) return null;
                const values = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
                if (values.length === 0) return null;
                let product = {};
                headers.forEach((header, i) => {
                    let value = values[i] || '';
                    if (value.startsWith('"') && value.endsWith('"')) value = value.slice(1, -1).replace(/""/g, '"');
                    product[header.trim()] = value;
                });
                
                product.variants = (product.variants || '').split(':').map(v_str => {
                    const parts = v_str.split('|').map(p => p.trim());
                    const size = parts[0] || '';
                    const price = parseFloat(parts[1]) || 0;
                    const images = parts.slice(2).filter(url => url); // Get all parts from index 2 onwards
                    return { size, price, images };
                }).filter(v => v.size && v.price > 0);
                
                product.galleryImages = [
                    product.galleryImage1, product.galleryImage2, product.galleryImage3,
                    product.galleryImage4, product.galleryImage5, product.galleryImage6
                ].filter(url => url && url.trim() !== '');

                product.order = parseInt(product.order, 10) || 99;
                return product;
            }).filter(p => p && p.id && p.variants.length > 0);

            products.sort((a, b) => a.order - b.order);
            return products;
        }


        async function fetchAndRenderProducts() {
            if (!googleSheetUrl || googleSheetUrl.includes('PASTE_YOUR_LINK')) {
                productSectionsContainer.innerHTML = `<p class="text-center text-red-600">Please provide a valid Google Sheet link.</p>`;
                return;
            }
            try {
                const response = await fetch(`${googleSheetUrl}&t=${new Date().getTime()}`);
                if (!response.ok) throw new Error(`Network error: ${response.statusText}`);
                const csvText = await response.text();
                allProducts = parseCSV(csvText);
                if (allProducts.length === 0) {
                    productSectionsContainer.innerHTML = `<p class="text-center text-gray-600">No products found. Check your Google Sheet.</p>`;
                    return;
                }
                // Process into categories (Global variable now)
                allCategories = allProducts.reduce((acc, product) => {
                    const categoryId = product.categoryId || product.categoryName.replace(/\s+/g, '-').toLowerCase();
                    
                    // Initialize category if not exists
                    if (!acc[categoryId]) {
                          // Store both English and Hindi names if available
                          acc[categoryId] = { 
                             name: product.categoryName, 
                             name_hi: product.categoryName_hi || product.categoryName, // Fallback to English
                             image: product.categoryImage || null, // Initialize with current row's image
                             products: [] 
                          };
                    }

                    // --- FIX: Check if current product has an image and update category if it was previously empty ---
                    // This ensures we find the image even if it's not in the first row of the category
                    if ((!acc[categoryId].image || acc[categoryId].image.trim() === '') && product.categoryImage && product.categoryImage.trim() !== '') {
                        acc[categoryId].image = product.categoryImage;
                    }

                    product.categoryId = categoryId;
                    acc[categoryId].products.push(product);
                    return acc;
                }, {});

                // Initial Render happens in renderAll() after data is ready
            } catch (error) {
                console.error("Error fetching products:", error);
                productSectionsContainer.innerHTML = `<p class="text-center text-red-600">Could not load products.</p>`;
            }
        }

        // --- NEW HELPER: Get Icon based on Category Name ---
        function getCategoryIcon(name) {
            const n = name.toLowerCase();
            // Default Icon (Tag/Category)
            let icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg>';

            // --- OILS ---
            if (n.includes('cold') && n.includes('oil')) {
                 // Cold Pressed Drop (Blueish tint logic handled via class usually, here just shape)
                 icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path><path d="M12 12v6" /></svg>';
            } else if (n.includes('wood') && n.includes('oil')) {
                 icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path><path d="M8 22h8" /><path d="M12 16v6" /></svg>';
            } else if (n.includes('mustard') || n.includes('sarso')) {
                 icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L14 7H10L12 2Z" /><circle cx="12" cy="14" r="6" /></svg>';
            } else if (n.includes('coconut') || n.includes('nariyal')) {
                 icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9" /><path d="M10 8h4" /><path d="M12 8v8" /></svg>';
            } else if (n.includes('groundnut') || n.includes('peanut') || n.includes('moongfali')) {
                 icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="7" y="5" width="10" height="14" rx="5" ry="5" /><line x1="7" y1="12" x2="17" y2="12" /></svg>';
            } else if (n.includes('sesame') || n.includes('til')) {
                 icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/><circle cx="12" cy="12" r="2"/></svg>';
            } else if (n.includes('oil') || n.includes('tel')) {
                 // Generic Oil
                 icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></svg>';
            
            // --- DAIRY & SWEETENERS ---
            } else if (n.includes('ghee') || n.includes('dairy') || n.includes('milk')) {
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 10h12v10H6z" /><path d="M6 6h12v4H6z" /><path d="M12 2v4" /></svg>'; // Jar
            } else if (n.includes('honey') || n.includes('madhu')) {
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>'; 
            } else if (n.includes('sugar') || n.includes('sweet') || n.includes('jaggery') || n.includes('gur') || n.includes('shakkar')) {
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>';
            } else if (n.includes('salt') || n.includes('namak')) {
                 icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v18h12V3"/><path d="M6 8h12" /><circle cx="12" cy="14" r="1"/></svg>';
            
            // --- GRAINS & FLOURS ---
            } else if (n.includes('millet') || n.includes('bajra') || n.includes('jowar') || n.includes('ragi')) {
                // Millet / Grain Stalk
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20"/><path d="M8 8l4-4 4 4"/><path d="M8 14l4-4 4 4"/><path d="M8 20l4-4 4 4"/></svg>';
            } else if (n.includes('rice') || n.includes('chawal') || n.includes('basmati')) {
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h20"/><path d="M2 12a10 10 0 0 0 20 0"/><path d="M12 2v10"/><path d="M17 7l-5 5-5-5"/></svg>';
            } else if (n.includes('pulse') || n.includes('dal') || n.includes('bean') || n.includes('chana') || n.includes('rajma')) {
                // Beans/Pulses
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="12" rx="7" ry="4" transform="rotate(45 12 12)"/></svg>';
            } else if (n.includes('flour') || n.includes('atta') || n.includes('wheat') || n.includes('grain') || n.includes('besan') || n.includes('maida')) {
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8.3l6-5.3 6 5.3"/><path d="M12 3v18"/><path d="M6 21v-8a6 6 0 0 1 12 0v8"/></svg>';
            
            // --- SPICES & CONDIMENTS ---
            } else if (n.includes('pickle') || n.includes('achar')) {
                // Pickle Jar
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 8h16v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8z"/><path d="M8 8V4a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v4"/><line x1="4" y1="12" x2="20" y2="12"/></svg>';
            } else if (n.includes('spice') || n.includes('masala') || n.includes('chilli') || n.includes('mirch') || n.includes('powder') || n.includes('turmeric') || n.includes('haldi')) {
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 22s5.5-3.5 9-10c2-3.5 2.5-6.5 2-8-.5-1.5-2.5-2.5-4-2-1.5.5-2.5 2.5-2 4 1.5 3.5 5 7 10 9"/></svg>';
            
            // --- SNACKS & SEEDS ---
            } else if (n.includes('seed') || n.includes('chia') || n.includes('flax') || n.includes('sunflower')) {
                // Seeds
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8z"/><circle cx="12" cy="12" r="1"/><circle cx="9" cy="9" r="1"/><circle cx="15" cy="15" r="1"/><circle cx="15" cy="9" r="1"/><circle cx="9" cy="15" r="1"/></svg>';
            } else if (n.includes('namkeen') || n.includes('snack') || n.includes('chips') || n.includes('bujia')) {
                // Bowl of Snacks
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h20a10 10 0 0 1-20 0"/><path d="M7 12l2-6"/><path d="M12 12l0-7"/><path d="M17 12l-2-6"/></svg>';
            } else if (n.includes('fruit') || n.includes('nut') || n.includes('dry') || n.includes('almond') || n.includes('cashew')) {
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a9 9 0 0 0-9 9v10a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V11a9 9 0 0 0-9-9z"/><path d="M12 2v10"/><path d="M12 12h10"/><path d="M12 12H2"/></svg>';
            
            // --- BEVERAGES & OTHERS ---
            } else if (n.includes('squash') || n.includes('juice') || n.includes('sharbat') || n.includes('drink')) {
                // Bottle/Glass
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10v12h10V10"/><path d="M10 2v8"/><path d="M14 2v8"/><path d="M7 10h10"/></svg>';
            } else if (n.includes('soap') || n.includes('shampoo') || n.includes('wash') || n.includes('care')) {
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.148-2.22-2.91-3.04-3.74-.954.83-2.03 1.676-3.04 3.74-.5 1-1 1.62-1 3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>';
            }

            return icon;
        }

        function renderCategories(categories) {
            // 1. Render Sidebar Cards (Grid) - Kept as cards
            categoryListContainer.innerHTML = Object.keys(categories).map((catId, i) => {
                const catData = categories[catId];
                const displayName = currentLang === 'hi' ? catData.name_hi : catData.name;
                
                // Logic: Use Image if available, else use Icon
                let visualElement;
                if (catData.image && catData.image.trim() !== '') {
                    visualElement = `<img src="${catData.image}" alt="${displayName}" class="w-full h-full object-cover">`;
                } else {
                    const iconSvg = getCategoryIcon(catData.name); 
                    visualElement = iconSvg; // Just the SVG
                }
                
                return `
                <button data-target="#${catId}" class="sidebar-category-btn w-full h-28 sm:h-32 flex flex-col items-center justify-center p-2 rounded-xl bg-white border border-gray-100 shadow-sm hover:shadow-md transition-all group ${i === 0 ? 'active' : ''}">
                    <div class="w-10 h-10 sm:w-12 sm:h-12 mb-2 rounded-full bg-orange-50 flex items-center justify-center text-amber-700 shadow-inner group-hover:scale-110 transition-transform overflow-hidden">
                        ${visualElement}
                    </div>
                    <span class="font-brand font-bold text-black text-sm sm:text-base leading-tight text-center group-hover:text-amber-900 px-1 line-clamp-2">${displayName}</span>
                </button>`;
            }).join('');

            // 2. Render Top Scrollable Strip (Horizontal Row)
            if(topCategoryStrip) {
                topCategoryStrip.innerHTML = Object.keys(categories).map((catId, i) => {
                    const catData = categories[catId];
                    const displayName = currentLang === 'hi' ? catData.name_hi : catData.name;
                    
                    // Logic: Use Image if available, else use Icon
                    let visualContent;
                    if (catData.image && catData.image.trim() !== '') {
                        visualContent = `<img src="${catData.image}" alt="${displayName}" class="w-full h-full object-cover">`;
                    } else {
                        const iconSvg = getCategoryIcon(catData.name); 
                        visualContent = `<div class="w-8 h-8 flex items-center justify-center">${iconSvg}</div>`;
                    }
                    
                    // UPDATED: Circular "Story" Style
                    return `
                    <button data-target="#${catId}" class="sidebar-category-btn flex flex-col items-center justify-start gap-1 min-w-[72px] p-1 transition-all group snap-start opacity-90 hover:opacity-100 ${i === 0 ? 'active' : ''}">
                        <!-- Circular Icon Container (Added overflow-hidden for images) -->
                        <div class="circle-icon-container w-16 h-16 rounded-full bg-white border-2 border-red-600 flex items-center justify-center text-black shadow-sm group-hover:scale-105 group-hover:border-red-800 transition-all overflow-hidden">
                            ${visualContent}
                        </div>
                        <!-- Text Label -->
                        <span class="font-brand font-bold text-black text-[11px] leading-tight text-center group-hover:text-amber-800 line-clamp-2 w-full">${displayName}</span>
                    </button>`;
                }).join('');
            }
        }

        // NEW FUNCTION: Render numbered pagination at the bottom
        function renderPagination(categories) {
            const keys = Object.keys(categories);
            if (keys.length <= 1) {
                categoryPaginationContainer.innerHTML = ''; // Hide if only 1 or 0 categories
                return;
            }
            categoryPaginationContainer.innerHTML = keys.map((catId, i) => {
                return `<button data-target="#${catId}" class="pagination-btn ${i === 0 ? 'active' : ''}" aria-label="Page ${i + 1}">${i + 1}</button>`;
            }).join('');
        }

        function renderProducts(categories) {
            const strings = uiStrings[currentLang];
            
            productSectionsContainer.innerHTML = Object.keys(categories).map((catId, i) => `
                <!-- CHANGED: Show first section by default (i > 0 hidden) -->
                <section id="${catId}" class="product-section ${i > 0 ? 'hidden' : ''}">
                    <div class="flex justify-center">
                        <!-- CHANGED: grid-cols-2 for mobile to show small cards, standard grid for desktop -->
                        <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-8 max-w-7xl w-full">
                            ${categories[catId].products.map(p => createCompactProductCardHTML(p, strings)).join('')}
                        </div>
                    </div>
                </section>
            `).join('');
            // Note: Wishlist status update on compact cards is simpler, we handle it in render
        }

        // --- NEW: Create Compact Card (Mini Card) ---
        function createCompactProductCardHTML(product, strings) {
            const defaultVariant = product.variants[0];
            // Get lowest price
            const lowestPrice = Math.min(...product.variants.map(v => v.price));
            
            // Language-specific data
            const displayName = currentLang === 'hi' ? (product.name_hi || product.name) : product.name;

            return `
            <div class="compact-product-card bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden flex flex-col h-full cursor-pointer hover:shadow-md transition-shadow relative" data-product-id="${product.id}">
                
                <!-- Image Section -->
                <div class="aspect-square bg-gray-50 relative flex items-center justify-center p-2">
                    <img src="${product.imageUrl}" alt="${displayName}" class="w-full h-full object-contain mix-blend-multiply" onerror="this.style.display='none'">
                    
                    <!-- Plus Button Overlay -->
                    <div class="absolute bottom-2 right-2 bg-white rounded-full p-1.5 shadow-md border border-gray-100 text-amber-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                    </div>
                </div>

                <!-- Content Section -->
                <div class="p-3 flex flex-col flex-grow">
                    <h3 class="text-sm font-brand font-bold text-gray-800 leading-tight line-clamp-2 mb-1">${displayName}</h3>
                    
                    <div class="mt-auto">
                        <p class="text-xs text-gray-500 mb-1">${product.variants.length} size${product.variants.length > 1 ? 's' : ''}</p>
                        <p class="text-base font-bold text-amber-800">From ‚Çπ${lowestPrice}</p>
                    </div>
                </div>
            </div>`;
        }

        // --- RENAMED: Create Full Detail Card (for Modal) ---
        function createFullProductCardHTML(product, strings) {
            const defaultVariant = product.variants[0];
            const mainGalleryImages = [product.imageUrl, ...product.galleryImages].filter(Boolean);
            
            const displayName = currentLang === 'hi' ? (product.name_hi || product.name) : product.name;
            const detailedDesc = currentLang === 'hi' ? (product.detailedDescription_hi || product.detailedDescription) : product.detailedDescription;

            // Note: We removed the wrapping .product-card styles here because the modal panel provides the container
            // UPDATED: Replaced text description with "Know More" button to open description popup
            // UPDATED: Added ViewContent pixel event
            // UPDATED: Sticky Footer implementation
            return `
            <div class="product-card-details flex flex-col h-full overflow-hidden" data-product-id="${product.id}" data-product-name="${displayName}" data-detailed-description="${detailedDesc || ''}" data-main-image="${product.imageUrl}">
                
                <!-- Scrollable Content Area (Image + Info) -->
                <div class="flex-grow overflow-y-auto custom-scrollbar">
                    <!-- Image Gallery -->
                    <div class="product-image-container bg-gray-50 h-64 sm:h-80 w-full relative">
                        ${buildGalleryHTML(mainGalleryImages)}
                    </div>
                    
                    <!-- Details Body -->
                    <div class="p-5 pb-2 text-center">
                        <h3 class="text-xl sm:text-2xl font-brand font-bold text-gray-800 mb-1 leading-tight">${displayName}</h3>
                        
                        <!-- Description Button -->
                        ${detailedDesc ? `<button class="know-more-btn text-amber-700 font-semibold underline text-xs sm:text-sm mt-1 mb-4 hover:text-amber-900 transition-colors">${strings.knowMore}</button>` : ''}
                        
                        <div class="mt-2 text-left w-full">
                            <p class="text-xs font-bold text-gray-400 mb-2 text-center uppercase tracking-widest">${strings.selectSize}</p>
                            <div class="flex flex-wrap gap-2 justify-center mb-4">
                                ${product.variants.map((v, i) => `<label class="variant-label cursor-pointer select-none"><input type="radio" name="modal-variant-${product.id}" class="sr-only" value="${v.price}" data-variant="${v.size}" ${i===0?'checked':''}><span class="block text-center border border-gray-200 rounded-lg px-4 py-2 text-sm font-medium transition-all hover:border-amber-400">${v.size}</span></label>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sticky Footer Area -->
                <div class="border-t border-gray-100 bg-white p-4 shrink-0 shadow-[0_-4px_20px_rgba(0,0,0,0.08)] z-10 relative">
                    
                    <!-- Quantity Row -->
                    <div class="flex items-center justify-between mb-4">
                         <span class="text-gray-500 text-sm font-medium">Quantity</span>
                         <div class="flex items-center border border-gray-300 rounded-lg overflow-hidden h-9">
                            <button class="quantity-btn minus w-10 bg-gray-50 hover:bg-gray-100 text-gray-600 h-full flex items-center justify-center text-lg" data-action="decrease">-</button>
                            <input type="number" class="quantity-input w-12 text-center border-none focus:ring-0 text-gray-800 font-bold h-full" value="1" min="1">
                            <button class="quantity-btn plus w-10 bg-gray-50 hover:bg-gray-100 text-gray-600 h-full flex items-center justify-center text-lg" data-action="increase">+</button>
                        </div>
                    </div>

                    <!-- Action Row -->
                    <div class="flex items-center gap-3">
                        <div class="flex flex-col">
                             <span class="text-[10px] text-gray-400 uppercase tracking-wide font-bold">Total</span>
                             <p class="text-2xl font-bold text-amber-800 price leading-none">‚Çπ${defaultVariant.price}</p>
                        </div>
                        
                        <!-- Wishlist in Modal -->
                        <button class="wishlist-btn p-3 rounded-full bg-gray-50 hover:bg-red-50 border border-gray-100 transition-colors shrink-0"><svg class="w-6 h-6 heart-icon" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 116.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"></path></svg></button>
                        
                        <button class="add-to-cart-btn btn-primary flex-grow font-bold text-lg py-3 px-4 rounded-xl shadow-lg transform active:scale-95 transition-transform flex items-center justify-center gap-2">
                            <span>${strings.addToCart}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>
                        </button>
                    </div>
                </div>
            </div>`;
        }
        
        function buildGalleryHTML(images) {
            if (!images || images.length === 0) return '';
            let html = images.map((imgUrl, index) => `<img src="${imgUrl}" alt="Product Image" class="gallery-image ${index === 0 ? 'active' : ''}" data-index="${index}" data-img-src="${imgUrl}" onerror="this.style.display='none'">`).join('');
            if (images.length > 1) {
                html += `
                <div class="gallery-nav">
                    <button class="gallery-prev"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                    <button class="gallery-next"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
                </div>
                <div class="gallery-dots">${images.map((_, index) => `<div class="dot ${index === 0 ? 'active' : ''}" data-index="${index}"></div>`).join('')}</div>`;
            }
            return html;
        }

        function setupEventListeners() {
            // Language Switch Listener
            if (langSwitchBtn) {
                langSwitchBtn.addEventListener('click', () => {
                    currentLang = currentLang === 'en' ? 'hi' : 'en';
                    localStorage.setItem(LANG_KEY, currentLang);
                    renderAll();
                });
            }
            
            // Logo Click -> Reload
            if (headerLogo) {
                headerLogo.addEventListener('click', () => {
                    window.location.reload();
                });
            }

            // Search Input Focus/Blur - Toggle Logo Visibility
            searchInput.addEventListener('focus', () => {
                // Hide logo
                if(headerLogo) {
                    headerLogo.classList.add('w-0', 'opacity-0', 'scale-0');
                }
            });

            searchInput.addEventListener('blur', () => {
                // Show logo (slight delay to prevent jarring if switching focus immediately, though usually immediate is fine here)
                // We use a small timeout to allow click events on search results to register before the layout shifts
                setTimeout(() => {
                    if(headerLogo) {
                        headerLogo.classList.remove('w-0', 'opacity-0', 'scale-0');
                    }
                }, 150);
            });

            document.body.addEventListener('click', e => {
                const target = e.target;
                if (!target.closest('#search-component')) {
                     searchResultsContainer.classList.add('hidden');
                }
                // Check for sidebar category button OR pagination button
                if (target.closest('.sidebar-category-btn')) handleCategoryClick(target.closest('.sidebar-category-btn'));
                if (target.closest('.pagination-btn')) handleCategoryClick(target.closest('.pagination-btn'));
                
                // --- MODAL HANDLERS START ---
                // Open Modal on Compact Card Click
                if (target.closest('.compact-product-card')) {
                    const card = target.closest('.compact-product-card');
                    openProductModal(card.dataset.productId);
                }

                // Modal interactions
                if (target.closest('.quantity-btn')) handleQuantityClick(target.closest('.quantity-btn'));
                if (target.closest('.add-to-cart-btn')) handleAddToCart(target.closest('.add-to-cart-btn'));
                // Note: Wishlist in modal handled below
                if (target.closest('.wishlist-btn')) {
                    // Determine if we are in modal or regular card (legacy support)
                    const container = target.closest('.product-card-details') || target.closest('.product-card');
                    if (container) handleToggleWishlist(target.closest('.wishlist-btn'), container);
                }
                
                // Handle Know More in Modal
                if (target.closest('.know-more-btn')) handleKnowMore(target.closest('.know-more-btn'));

                if (target.closest('.gallery-prev')) handleGalleryNav(target.closest('.gallery-prev'), 'prev');
                if (target.closest('.gallery-next')) handleGalleryNav(target.closest('.gallery-next'), 'next');
                if (target.closest('.dot')) handleGalleryDot(target.closest('.dot'));
            });
            document.body.addEventListener('change', e => {
                // Handle variant change inside modal
                if (e.target.matches('input[name^="modal-variant-"]')) {
                    handleVariantChange(e.target, true); // true = inside modal
                }
                else if (e.target.matches('input[name^="variant-"]')) {
                    handleVariantChange(e.target, false); 
                }
            });
            
            searchInput.addEventListener('input', handleLiveSearch);
            searchInput.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleSearchFilter();
                    searchResultsContainer.classList.add('hidden');
                    searchInput.blur();
                }
            });
            const toggleSidebar = (sidebar) => {
                const isOpen = sidebar.classList.contains('open');
                document.querySelectorAll('.sidebar.open').forEach(s => s !== sidebar && s.classList.replace('open', 'closed'));
                sidebar.classList.toggle('open', !isOpen);
                sidebar.classList.toggle('closed', isOpen);
                sidebarOverlay.classList.toggle('hidden', !document.querySelector('.sidebar.open'));
            };
            if(openCartBtn) openCartBtn.addEventListener('click', () => toggleSidebar(cartSidebar));
            closeCartBtn.addEventListener('click', () => toggleSidebar(cartSidebar));
            if(floatingCartPill) floatingCartPill.addEventListener('click', () => toggleSidebar(cartSidebar)); 

            openWishlistBtn.addEventListener('click', () => toggleSidebar(wishlistSidebar));
            closeWishlistBtn.addEventListener('click', () => toggleSidebar(wishlistSidebar));
            
            // Check if element exists before adding listener (since we removed it from HTML)
            if(openCategoryMenuBtn) {
                openCategoryMenuBtn.addEventListener('click', () => toggleSidebar(categorySidebar));
            }
            
            if(openCategoryFooterBtn) openCategoryFooterBtn.addEventListener('click', () => toggleSidebar(categorySidebar)); 
            closeCategorySidebarBtn.addEventListener('click', () => toggleSidebar(categorySidebar));
            
            sidebarOverlay.addEventListener('click', () => document.querySelectorAll('.sidebar.open').forEach(toggleSidebar));
            
            cartItemsContainer.addEventListener('click', e => {
                const qBtn = e.target.closest('.cart-quantity-btn'), rBtn = e.target.closest('.remove-from-cart-btn');
                if (qBtn) {
                    const { action, id, variant } = qBtn.dataset;
                    const item = cart.find(i => i.id === id && i.variant === variant);
                    if(item) updateCartQuantity(id, variant, item.quantity + (action === 'increase' ? 1 : -1));
                }
                if (rBtn) removeFromCart(rBtn.dataset.id, rBtn.dataset.variant);
            });
            cartItemsContainer.addEventListener('change', e => {
                const qInput = e.target.closest('.cart-quantity-input');
                if(qInput) updateCartQuantity(qInput.dataset.id, qInput.dataset.variant, parseInt(qInput.value) || 1);
            });
            
            wishlistItemsContainer.addEventListener('click', e => {
                const removeBtn = e.target.closest('.remove-from-wishlist-btn');
                if (removeBtn) {
                    const { id, variant } = removeBtn.dataset;
                    removeFromWishlist(id, variant);
                }
            });

            checkoutBtn.addEventListener('click', handleCheckoutStart);
            returningCustomerBtn.addEventListener('click', handleReturningCustomerCheckout);
            newCustomerBtn.addEventListener('click', handleNewCustomer);
            proceedToPaymentBtn.addEventListener('click', handleCompleteCheckout); // CHANGED listener
            closeCheckoutModalBtn.addEventListener('click', closeCheckoutModal);
            checkoutModal.addEventListener('click', e => e.target === checkoutModal && closeCheckoutModal());
            
            // Payment selection buttons
            document.querySelectorAll('.payment-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    handlePaymentSelection(e.target.dataset.mode);
                });
            });

            // New Product Modal Listeners
            closeProductModalBtn.addEventListener('click', closeProductModal);
            productModalBackdrop.addEventListener('click', closeProductModal);

            closeModalBtn.addEventListener('click', closeKnowMoreModal);
            knowMoreModal.addEventListener('click', e => e.target === knowMoreModal && closeKnowMoreModal());

            howToOrderBtn.addEventListener('click', openHowToOrderModal);
            closeHowToOrderModalBtn.addEventListener('click', closeHowToOrderModal);
            howToOrderModal.addEventListener('click', e => e.target === howToOrderModal && closeHowToOrderModal);

            // Support Modal Event Listeners
            if (openSupportBtn) {
                openSupportBtn.addEventListener('click', () => {
                    supportModal.classList.remove('hidden');
                    setTimeout(() => supportModal.classList.remove('opacity-0'), 10);
                    setTimeout(() => supportModal.querySelector('.modal-content').classList.remove('scale-95'), 10);
                });
            }
            if (closeSupportModalBtn) {
                closeSupportModalBtn.addEventListener('click', () => {
                    supportModal.querySelector('.modal-content').classList.add('scale-95');
                    supportModal.classList.add('opacity-0');
                    setTimeout(() => supportModal.classList.add('hidden'), 300);
                });
            }
            if (supportModal) {
                supportModal.addEventListener('click', e => {
                    if(e.target === supportModal) {
                        supportModal.querySelector('.modal-content').classList.add('scale-95');
                        supportModal.classList.add('opacity-0');
                        setTimeout(() => supportModal.classList.add('hidden'), 300);
                    }
                });
            }
        }

        // --- Product Modal Logic ---
        function openProductModal(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            const strings = uiStrings[currentLang];
            
            // Render Full Card HTML into Modal
            productModalContent.innerHTML = createFullProductCardHTML(product, strings);
            
            // Initialize Wishlist State in Modal
            const modalContainer = productModalContent.querySelector('.product-card-details');
            updateCardWishlistStatus(modalContainer);

            // --- TRACKING ADDED ---
            const defaultVariant = product.variants[0];
            // Meta Pixel
            if(typeof fbq === 'function') {
                fbq('track', 'ViewContent', { 
                    content_name: product.name, 
                    content_category: product.categoryName,
                    content_ids: [product.id],
                    content_type: 'product',
                    value: defaultVariant.price, 
                    currency: 'INR' 
                });
            }
            // GA4
            if(typeof gtag === 'function') {
                gtag('event', 'view_item', { 
                    currency: 'INR', 
                    value: defaultVariant.price, 
                    items: [{ item_id: product.id, item_name: product.name, price: defaultVariant.price, item_category: product.categoryName }] 
                });
            }

            // Show Modal
            productModal.classList.remove('closed');
            // Small delay for CSS transition to trigger
            setTimeout(() => productModal.classList.add('open'), 10);
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeProductModal() {
            productModal.classList.remove('open');
            setTimeout(() => {
                productModal.classList.add('closed');
                productModalContent.innerHTML = ''; // Cleanup
            }, 300); // Match CSS transition
            document.body.style.overflow = '';
        }

        function handleCategoryClick(btn) {
            if(!btn) return; // Guard clause
            const targetId = btn.dataset.target;

            // Removed homeView logic

            // Update Active State for BOTH Sidebar buttons AND Pagination buttons
            // We look for any button (sidebar or pagination) that targets the same ID
            const allNavButtons = document.querySelectorAll(`[data-target]`);
            allNavButtons.forEach(b => {
                if (b.dataset.target === targetId) {
                    b.classList.add('active');
                } else {
                    b.classList.remove('active');
                }
            });

            // Show/Hide Product Sections
            document.querySelectorAll('.product-section').forEach(s => {
                s.classList.toggle('hidden', `#${s.id}` !== targetId);
            });
            
            searchInput.value = '';
            handleSearchFilter();

            // Close sidebar on mobile/desktop after selection if it was open
            const categorySidebar = document.getElementById('category-sidebar');
            if (categorySidebar.classList.contains('open')) {
                categorySidebar.classList.replace('open', 'closed');
                document.getElementById('sidebar-overlay').classList.add('hidden');
            }

            const targetSection = document.querySelector(targetId);
            if (targetSection) {
                // Determine offset based on whether we are mobile or desktop
                // On mobile, the sticky header is smaller, on desktop larger.
                const header = document.querySelector('header');
                const headerHeight = header ? header.offsetHeight : 120;
                const extraOffset = 20; 
                
                // Calculate position relative to document
                const bodyRect = document.body.getBoundingClientRect().top;
                const elementRect = targetSection.getBoundingClientRect().top;
                const elementPosition = elementRect - bodyRect;
                const offsetPosition = elementPosition - headerHeight - extraOffset;
    
                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });
            }
        }
        
        function handleLiveSearch(e) {
            const term = e.target.value.toLowerCase();
            if (term.length < 2) {
                searchResultsContainer.classList.add('hidden');
                return;
            }
            // Search logic handles both languages roughly by checking if display name contains string
            const results = allProducts.filter(p => {
                const nameEn = (p.name || '').toLowerCase();
                const nameHi = (p.name_hi || '').toLowerCase();
                return nameEn.includes(term) || nameHi.includes(term);
            });
            
            const strings = uiStrings[currentLang];
            searchResultsContainer.innerHTML = results.length ? results.map(p => {
                const dName = currentLang === 'hi' ? (p.name_hi || p.name) : p.name;
                return `<div class="search-result-item block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer" data-product-id="${p.id}">${dName}</div>`;
            }).join('') : `<span class="block px-4 py-2 text-sm text-gray-500">${strings.noResults}</span>`;
            searchResultsContainer.classList.remove('hidden');

             searchResultsContainer.querySelectorAll('.search-result-item').forEach(item => {
                item.addEventListener('click', e => {
                    e.preventDefault();
                    const productId = item.dataset.productId;
                    const product = allProducts.find(p => p.id === productId);
                    if (!product) return;

                    // Open Modal directly from search
                    openProductModal(productId);
                    
                    searchResultsContainer.classList.add('hidden');
                     searchInput.value = '';
                });
            });
        }
        
        function generateWhatsAppLink(address = '', paymentMode = '') {
            let orderDetails = cart.map(i => `*${i.name}*\n - Size: ${i.variant}\n - Qty: ${i.quantity}\n - Price: ‚Çπ${(i.price * i.quantity).toFixed(2)}`).join('\n\n');
            const total = cart.reduce((acc, i) => acc + i.price * i.quantity, 0);
            
            // --- TRACKING UPDATED (FINAL CONVERSION) ---
            // This is the final step, so we track it as a 'Purchase'
            if(typeof fbq === 'function') {
                fbq('track', 'Purchase', { 
                    value: total, 
                    currency: 'INR',
                    content_ids: cart.map(i => i.id),
                    num_items: cart.length
                });
            }
            if(typeof gtag === 'function') {
                gtag('event', 'purchase', { 
                    transaction_id: 'WA-' + Date.now(), // Unique ID based on timestamp
                    value: total, 
                    currency: 'INR',
                    items: cart.map(i => ({ item_id: i.id, item_name: i.name, price: i.price, quantity: i.quantity }))
                });
            }

            let finalMessage = "I want to order:\n\n";

            if (address.trim() !== '') {
                finalMessage += `*Shipping Address:*\n${address.trim()}\n\n`;
            }
            
            if (paymentMode.trim() !== '') {
                finalMessage += `*Payment Mode:* ${paymentMode}\n\n`;
            } else {
                finalMessage += `*Payment Mode:* Not Selected\n\n`;
            }

            finalMessage += "------------------------\n\n";
            finalMessage += orderDetails;
            finalMessage += `\n\n*Total: ‚Çπ${total.toFixed(2)}*`;
            
            window.open(`https://wa.me/916262120120?text=${encodeURIComponent(finalMessage)}`, '_blank');
        }

        function handleCheckoutStart() {
            if (cart.length === 0) {
                showToast(uiStrings[currentLang].emptyCart, 'error');
                return;
            }

            // --- TRACKING ADDED (CHECKOUT BUTTON CLICK) ---
            const total = cart.reduce((acc, i) => acc + i.price * i.quantity, 0);
            const items = cart.map(i => ({ item_id: i.id, item_name: i.name, price: i.price, quantity: i.quantity }));

            if(typeof gtag === 'function') {
                // 1. Custom 'checkouts' event (As requested)
                gtag('event', 'checkouts', { 
                    value: total, 
                    currency: 'INR', 
                    items: items 
                });
                
                // 2. Standard 'begin_checkout' event (Good for standard reports)
                gtag('event', 'begin_checkout', { 
                    value: total, 
                    currency: 'INR', 
                    items: items 
                });
            }
            
            if(typeof fbq === 'function') {
                fbq('track', 'InitiateCheckout', { 
                    value: total, 
                    currency: 'INR', 
                    content_ids: cart.map(i => i.id), 
                    num_items: cart.length 
                });
            }

            openCheckoutModal();
        }

        function handleReturningCustomerCheckout() {
            // New logic: Returning Customer -> Select Payment (Step 3)
            checkoutStep1.classList.add('hidden');
            checkoutStep3.classList.remove('hidden');
            shippingAddressInput.value = ''; // Ensure address is empty for "Old" flow so it's not sent
        }

        function handleNewCustomer() {
            checkoutStep1.classList.add('hidden');
            checkoutStep2.classList.remove('hidden');
        }
        
        function handleCompleteCheckout() {
            const address = shippingAddressInput.value;
            if (address.trim() === '') {
                addressError.classList.remove('hidden');
                shippingAddressInput.focus();
                return;
            }
            addressError.classList.add('hidden');
            
            // Move to Payment Selection (Step 3)
            checkoutStep2.classList.add('hidden');
            checkoutStep3.classList.remove('hidden');
        }

        function handlePaymentSelection(mode) {
            const address = shippingAddressInput.value;
            generateWhatsAppLink(address, mode);
            closeCheckoutModal();
        }

        function openCheckoutModal() {
            checkoutStep1.classList.remove('hidden');
            checkoutStep2.classList.add('hidden');
            checkoutStep3.classList.add('hidden');
            addressError.classList.add('hidden');
            shippingAddressInput.value = '';

            checkoutModal.classList.remove('hidden');
            setTimeout(() => checkoutModal.classList.remove('opacity-0'), 10);
            setTimeout(() => checkoutModal.querySelector('.modal-content').classList.remove('scale-95'), 10);
        }

        function closeCheckoutModal() {
            checkoutModal.querySelector('.modal-content').classList.add('scale-95');
            checkoutModal.classList.add('opacity-0');
            setTimeout(() => checkoutModal.classList.add('hidden'), 300);
        }

        function handleSearchFilter() {
            const term = searchInput.value.toLowerCase();
            document.querySelectorAll('.compact-product-card').forEach(card => { // Changed to compact-product-card
                // We need to look inside the card content because data-attributes might not be fully searchable text in compact mode?
                // Actually the data-attributes are still on the card div.
                const parentSection = card.closest('.product-section');
                if(!parentSection) return; // safety
                
                // We need to check if the Product object matches, but we don't have it direct here easily without lookup
                // Simple approach: re-render? No, too heavy.
                // CSS approach:
                // We stored data-product-id. Let's look up the product.
                
                const productId = card.dataset.productId;
                const product = allProducts.find(p => p.id === productId);
                const nameEn = (product?.name || '').toLowerCase();
                const nameHi = (product?.name_hi || '').toLowerCase();
                
                const matches = nameEn.includes(term) || nameHi.includes(term);
                const isHiddenByCategory = parentSection.classList.contains('hidden');
                
                card.style.display = (matches && !isHiddenByCategory) ? 'flex' : 'none';
            });
        }

        function handleQuantityClick(btn) {
            const input = btn.closest('div').querySelector('.quantity-input');
            let val = parseInt(input.value);
            input.value = btn.dataset.action === 'increase' ? val + 1 : Math.max(1, val - 1);
        }
        
        function handleVariantChange(input, isModal) {
            // Updated to handle modal scope
            const container = isModal ? document.getElementById('product-modal-content').querySelector('.product-card-details') : input.closest('.product-card');
            if(!container) return;

            container.querySelector('.price').textContent = `‚Çπ${input.value}`;
            updateCardWishlistStatus(container);

            const productId = container.dataset.productId;
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            const variantSize = input.dataset.variant;
            const selectedVariant = product.variants.find(v => v.size === variantSize);
            
            let imagesToShow = [product.imageUrl, ...product.galleryImages].filter(Boolean);
            if (selectedVariant && selectedVariant.images.length > 0) {
                imagesToShow = selectedVariant.images;
            }

            const imageContainer = container.querySelector('.product-image-container');
            imageContainer.innerHTML = buildGalleryHTML(imagesToShow);
        }

        function handleAddToCart(btn) {
            // Handle both Modal and Regular (though regular shouldn't exist anymore for adding, logic remains valid)
            const container = btn.closest('.product-card-details') || btn.closest('.product-card');
            
            const v = container.querySelector('input[type="radio"]:checked');
            const imageElement = container.querySelector('.gallery-image.active');
            let image = container.dataset.mainImage || 'https://placehold.co/100x100/FFF9C4/3E2723?text=No+Image';
            if (imageElement) {
                image = imageElement.src;
            }
            const item = { id: container.dataset.productId, name: container.dataset.productName, image: image, variant: v.dataset.variant, price: parseFloat(v.value), quantity: parseInt(container.querySelector('.quantity-input').value) };
            addToCart(item);
            
            // --- TRACKING ADDED (ADD TO CART) ---
            if(typeof fbq === 'function') {
                fbq('track', 'AddToCart', { 
                    content_name: item.name, 
                    content_ids: [item.id],
                    content_type: 'product',
                    value: item.price, 
                    currency: 'INR' 
                });
            }
            if(typeof gtag === 'function') {
                gtag('event', 'add_to_cart', { 
                    currency: 'INR', 
                    value: item.price, 
                    items: [{ item_id: item.id, item_name: item.name, price: item.price, quantity: item.quantity }] 
                });
            }

            const strings = uiStrings[currentLang];
            const originalText = btn.textContent;
            
            btn.classList.add('added');
            btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block -mt-1 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>${strings.added}`;
            
            setTimeout(() => { 
                btn.classList.remove('added'); 
                btn.textContent = strings.addToCart; // Use UI string to reset correctly
                closeProductModal(); // Close modal after adding
            }, 1200);
        }

        function handleToggleWishlist(btn, container) {
            const v = container.querySelector('input[type="radio"]:checked');
            const imageElement = container.querySelector('.gallery-image.active');
            let image = container.dataset.mainImage || 'https://placehold.co/100x100/FFF9C4/3E2723?text=No+Image';
            if (imageElement) {
                image = imageElement.src;
            }
            const item = { id: container.dataset.productId, name: container.dataset.productName, image: image, variant: v.dataset.variant, price: parseFloat(v.value) };
            toggleWishlist(item, btn);
        }
        
        function handleKnowMore(btn) {
            // Find the container (it's the product-card-details div in the modal)
            const card = btn.closest('.product-card-details');
            if (card) {
                modalTitle.textContent = card.dataset.productName;
                modalDescription.textContent = card.dataset.detailedDescription || 'No description available.';
                
                // Show the modal
                knowMoreModal.classList.remove('hidden');
                setTimeout(() => knowMoreModal.classList.remove('opacity-0'), 10);
                setTimeout(() => knowMoreModal.querySelector('.modal-content').classList.remove('scale-95'), 10);
            }
        }

        function closeKnowMoreModal() {
            knowMoreModal.querySelector('.modal-content').classList.add('scale-95');
            knowMoreModal.classList.add('opacity-0');
            setTimeout(() => knowMoreModal.classList.add('hidden'), 300);
        }

        function openHowToOrderModal() {
            howToOrderModal.classList.remove('hidden');
            setTimeout(() => howToOrderModal.classList.remove('opacity-0'), 10);
            setTimeout(() => howToOrderModal.querySelector('.modal-content').classList.remove('scale-95'), 10);
        }

        function closeHowToOrderModal() {
            howToOrderModal.querySelector('.modal-content').classList.add('scale-95');
            howToOrderModal.classList.add('opacity-0');
            setTimeout(() => howToOrderModal.classList.add('hidden'), 300);
        }

        function handleGalleryNav(button, direction) {
            // Works for both modal and regular if class structure is same
            const container = button.closest('.product-card-details') || button.closest('.product-card');
            const images = container.querySelectorAll('.gallery-image');
            const current = container.querySelector('.gallery-image.active');
            let currentIndex = parseInt(current.dataset.index);
            let newIndex;
            if (direction === 'next') {
                newIndex = (currentIndex + 1) % images.length;
            } else {
                newIndex = (currentIndex - 1 + images.length) % images.length;
            }
            
            // Helper to update gallery in specific container
            const dots = container.querySelectorAll('.dot');
            images.forEach((img, idx) => img.classList.toggle('active', idx === newIndex));
            if (dots.length > 0) {
                dots.forEach((dot, idx) => dot.classList.toggle('active', idx === newIndex));
            }
        }

        function handleGalleryDot(dot) {
            const container = dot.closest('.product-card-details') || dot.closest('.product-card');
            const newIndex = parseInt(dot.dataset.index);
            // Same helper logic
            const images = container.querySelectorAll('.gallery-image');
            const dots = container.querySelectorAll('.dot');
            images.forEach((img, idx) => img.classList.toggle('active', idx === newIndex));
            if (dots.length > 0) {
                dots.forEach((dot, idx) => dot.classList.toggle('active', idx === newIndex));
            }
        }

        // Update Gallery generic function removed/inline above for context awareness
        
        function loadStateFromLocalStorage() {
            cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];
            wishlist = JSON.parse(localStorage.getItem(WISHLIST_KEY)) || [];
        }
        function saveState() {
            localStorage.setItem(CART_KEY, JSON.stringify(cart));
            localStorage.setItem(WISHLIST_KEY, JSON.stringify(wishlist));
        }
        function addToCart(newItem) {
            const existing = cart.find(i => i.id === newItem.id && i.variant === newItem.variant);
            if (existing) existing.quantity += newItem.quantity;
            else cart.push(newItem);
            updateAllCartUI();
        }
        function removeFromCart(id, variant) {
            cart = cart.filter(i => !(i.id === id && i.variant === variant));
            updateAllCartUI();
        }
        function updateCartQuantity(id, variant, qty) {
            if (qty < 1) return removeFromCart(id, variant);
            const item = cart.find(i => i.id === id && i.variant === variant);
            if (item) item.quantity = qty;
            updateAllCartUI();
        }
        function toggleWishlist(item, btn) {
            const idx = wishlist.findIndex(w => w.id === item.id && w.variant === item.variant);
            if (idx > -1) wishlist.splice(idx, 1);
            else wishlist.push(item);
            btn.classList.toggle('active', idx === -1);
            updateAllWishlistUI();
        }

        function removeFromWishlist(id, variant) {
            wishlist = wishlist.filter(item => !(item.id === id && item.variant === variant));
            updateAllWishlistUI();
            
            // Note: If modal is open for this product, update it
            if(!productModal.classList.contains('closed')) {
               const modalContainer = document.getElementById('product-modal-content').querySelector('.product-card-details');
               if(modalContainer && modalContainer.dataset.productId === id) {
                   const v = modalContainer.querySelector('input[type="radio"]:checked');
                   if(v && v.dataset.variant === variant) {
                        modalContainer.querySelector('.wishlist-btn').classList.remove('active');
                   }
               }
            }
        }

        function moveFromWishlistToCart(item) {
            wishlist = wishlist.filter(w => !(w.id === item.id && w.variant === item.variant));
            addToCart({...item, quantity: 1});
            // Update modal if open? handled by re-renders or specific checks usually, but simple toast is enough
            updateAllWishlistUI();
            showToast(`${item.name} moved to cart!`, 'success');
        }
        function updateAllCartUI() {
            renderCart();
            updateCartHeader();
            saveState();
        }
        function updateAllWishlistUI() {
            renderWishlist();
            updateWishlistCount();
            saveState();
        }
        function renderCart() {
            const total = cart.reduce((acc, i) => acc + i.price * i.quantity, 0);
            const strings = uiStrings[currentLang];
            cartTotalEl.textContent = `‚Çπ${total.toFixed(2)}`;
            cartItemsContainer.innerHTML = cart.length === 0 ? `<p class="text-gray-500 text-center mt-8">${strings.emptyCart}</p>` : cart.map(item => `
                <div class="flex items-center gap-4 py-3 border-b">
                    <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-contain rounded-md p-1 bg-gray-50">
                    <div class="flex-grow">
                        <p class="font-bold text-sm">${item.name}</p>
                        <p class="text-xs text-gray-500">${item.variant}</p>
                        <p class="font-semibold text-amber-800 text-sm mt-1">‚Çπ${item.price.toFixed(2)}</p>
                    </div>
                    <div class="flex items-center border border-gray-300 rounded-md">
                        <button class="cart-quantity-btn p-2" data-action="decrease" data-id="${item.id}" data-variant="${item.variant}">-</button>
                        <input type="number" class="w-10 text-center text-sm border-none focus:ring-0" value="${item.quantity}" min="1" data-id="${item.id}" data-variant="${item.variant}">
                        <button class="cart-quantity-btn p-2" data-action="increase" data-id="${item.id}" data-variant="${item.variant}">+</button>
                    </div>
                    <button class="remove-from-cart-btn text-gray-400 hover:text-red-500 p-2" data-id="${item.id}" data-variant="${item.variant}"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg></button>
                </div>`).join('');
        }
        function renderWishlist() {
            const strings = uiStrings[currentLang];
            wishlistItemsContainer.innerHTML = wishlist.length === 0 ? `<p class="text-gray-500 text-center mt-8">${strings.emptyWishlist}</p>` : wishlist.map(item => `
                <div class="flex items-center gap-4 py-2 border-b">
                    <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-contain rounded-md p-1 bg-gray-50">
                    <div class="flex-grow">
                        <p class="font-bold text-sm">${item.name}</p>
                        <p class="text-xs text-gray-500">${item.variant}</p>
                        <p class="font-semibold text-amber-800 text-sm mt-1">‚Çπ${item.price.toFixed(2)}</p>
                    </div>
                    <button class="move-to-cart-btn btn-primary text-xs px-3 py-2 rounded-md" data-item='${JSON.stringify(item)}'>${strings.moveToCart}</button>
                    <button class="remove-from-wishlist-btn text-gray-400 hover:text-red-500 p-2" data-id="${item.id}" data-variant="${item.variant}">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>`).join('');
            wishlistItemsContainer.querySelectorAll('.move-to-cart-btn').forEach(btn => btn.addEventListener('click', e => moveFromWishlistToCart(JSON.parse(e.currentTarget.dataset.item))));
        }
        function updateCartHeader() {
            const count = cart.reduce((acc, i) => acc + i.quantity, 0);
            const total = cart.reduce((acc, i) => acc + i.price * i.quantity, 0);
            
            // Update Top Header Cart (if exists)
            const header = document.getElementById('cart-total-header');
            const cartBtn = document.getElementById('open-cart-btn');
            
            if(cartCountBadge) {
                cartCountBadge.textContent = count;
                cartCountBadge.classList.toggle('hidden', count === 0);
            }
            if(header) {
                header.textContent = `‚Çπ${total.toFixed(2)}`;
                header.classList.toggle('hidden', total === 0);
            }
            
            if(cartBtn) {
                 if (count > 0) {
                    cartBtn.classList.add('cart-blink');
                } else {
                    cartBtn.classList.remove('cart-blink');
                }
            }

            // Update Floating Cart Pill
            if(floatingCartPill) {
                if(count > 0) {
                    floatingCartPill.classList.remove('hidden');
                    // Small delay to allow display:block to apply before opacity transition
                    setTimeout(() => floatingCartPill.classList.add('visible'), 10);
                    
                    // UPDATED: Added total price display here
                    floatingCartCount.textContent = `${count} item${count !== 1 ? 's' : ''} ‚Ä¢ ‚Çπ${total.toFixed(2)}`;
                    
                    // Show image of last added item
                    const lastItem = cart[cart.length - 1];
                    if(lastItem && lastItem.image) {
                        floatingCartImg.src = lastItem.image;
                    }
                } else {
                    floatingCartPill.classList.remove('visible');
                    // Wait for transition to finish before hiding
                    setTimeout(() => floatingCartPill.classList.add('hidden'), 300);
                }
            }
        }
        function updateWishlistCount() {
            const count = wishlist.length;
            wishlistCountBadge.textContent = count;
            wishlistCountBadge.classList.toggle('hidden', count === 0);
        }
        function updateCardWishlistStatus(card) {
            if(!card) return;
            const v = card.querySelector('input[type="radio"]:checked');
            if (!v) return;
            const isInWishlist = wishlist.some(i => i.id === card.dataset.productId && i.variant === v.dataset.variant);
            const btn = card.querySelector('.wishlist-btn');
            if(btn) btn.classList.toggle('active', isInWishlist);
        }
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                toast.addEventListener('transitionend', () => toast.remove());
            }, 3000);
        }

        init();
    });
    </script>
</body>
</html>
